
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>MOKO Widgets #3 - styles</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid="UA-81805223-5"
                  id="moko-widgets-3"
                  title="MOKO Widgets #3 - styles"
                  environment="web"
                  feedback-link="https://github.com/icerockdev/kmp-codelabs/issues">
    
      <google-codelab-step label="Вводная" duration="5">
        <p>Урок является продолжением <a href="https://codelabs.kmp.icerock.dev/codelabs/moko-widgets-2/" target="_blank">MOKO Widgets #2 - routing</a>. Для выполнения данного урока нужно иметь проект, полученный в результате выполнения предыдущего урока.</p>
<p>Результатом прошлого урока было приложение с экранами:</p>
<ul>
<li>Ввод телефона;</li>
<li>Ввод кода;</li>
<li>Профиль;</li>
<li>Редактирование профиля;</li>
<li>Информация.</li>
</ul>
<p>На этом уроке мы добавим стилизацию экранов. Это включает в себя:</p>
<ul>
<li>Изменение tint;</li>
<li>Изменение стиля всех элементов определенного типа;</li>
<li>Изменение стиля группы элементов определенного типа;</li>
<li>Изменение стиля конкретного элемента;</li>
<li>Стилизация BottomNavigation.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Настройка платформенных стилей" duration="10">
        <p>В результате предыдущего урока получено приложение, в котором стартовый экран выглядит так:</p>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p class="image-container"><img alt="android-app" src="img/411e0c8f824888b1.png"></p>
</td><td colspan="1" rowspan="1"><p class="image-container"><img alt="ios-app" src="img/7e63a1fd2ac80bdf.png"></p>
</td></tr>
</table>
<p>Теперь изменим цвет статусбара и навбара на Android, а так же акцент цвет на обеих платформах (синий на iOS и ярко зеленый на Android).</p>
<h2 is-upgraded>Android</h2>
<p>На Android изменения этих цветов выполняются через тему приложения в файле <code>android-app/src/main/res/values/styles.xml</code>:</p>
<pre><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;resources&gt;
    &lt;style name=&#34;AppTheme&#34; parent=&#34;Theme.AppCompat.Light.NoActionBar&#34;&gt;
        &lt;!-- your app branding color for the app bar --&gt;
        &lt;item name=&#34;colorPrimary&#34;&gt;#FF4caf50&lt;/item&gt;
        &lt;!-- darker variant for the status bar and contextual app bars --&gt;
        &lt;item name=&#34;colorPrimaryDark&#34;&gt;#FF087f23&lt;/item&gt;
        &lt;!-- theme UI controls like checkboxes and text fields --&gt;
        &lt;item name=&#34;colorAccent&#34;&gt;#FF80e27e&lt;/item&gt;
    &lt;/style&gt;
&lt;/resources&gt;
</code></pre>
<p><code>collorAccent</code> отвечает за цвет указателя в тексте, лейбла и подчеркивания по умолчанию и используется в других подобных местах для обращения внимания. Цвет указателя в тексте можно заменить только через данный файл стилей.<br><code>colorPrimaryDark</code> это цвет статусбара, тоже можно менять только через данный файл.</p>
<p>Сменим цвет на оранжевую тему:</p>
<pre><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;resources&gt;
    &lt;style name=&#34;AppTheme&#34; parent=&#34;Theme.AppCompat.Light.NoActionBar&#34;&gt;
        &lt;!-- your app branding color for the app bar --&gt;
        &lt;item name=&#34;colorPrimary&#34;&gt;#FFffb74d&lt;/item&gt;
        &lt;!-- darker variant for the status bar and contextual app bars --&gt;
        &lt;item name=&#34;colorPrimaryDark&#34;&gt;#FFc88719&lt;/item&gt;
        &lt;!-- theme UI controls like checkboxes and text fields --&gt;
        &lt;item name=&#34;colorAccent&#34;&gt;#FFffbd45&lt;/item&gt;
    &lt;/style&gt;
&lt;/resources&gt;
</code></pre>
<p>В результате получим:<br><img alt="android-app" src="img/62b6dd3b914f2fa4.png"></p>
<h2 is-upgraded>iOS</h2>
<p>На iOS можно задать глобальный tint цвет, который выдаст нужный нам результат.<br>Для этого в <code>ios-app/src/AppDelegate.swift</code> нужно добавить:</p>
<pre><code>func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]? = nil) -&gt; Bool {
    ...

    window = UIWindow(frame: UIScreen.main.bounds)
    ...
    window?.tintColor = UIColor(red:1.00, green:0.74, blue:0.27, alpha:1.0)
    window?.makeKeyAndVisible()

    return true
}
</code></pre>
<p>И получим:<br><img alt="ios-app" src="img/4585923e8c9b2d6b.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Глобальное применение стилей" duration="10">
        <p>Следующий этап стилизации - оформление всех кнопок в соответствии дизайну. По дизайну требуется чтобы был фон кнопок оранжевого цвета, текст черный с размером шрифта 15.</p>
<p>Для применения данных настроек нам нужно воспользоваться возможностями класса <code>Theme</code>. В нашем проекте уже есть создание объекта этого класса и он используется для дальнейшего создания всех виджетов. Сейчас нам нужно задать что в данной теме все кнопки будут создаваться с кастомным стилем.</p>
<p>Оформление по умолчанию устанавливается через категорию <code>ButtonWidget.DefaultCategory</code> в <code>Theme</code>, его нам и нужно кастомизировать.</p>
<aside class="special"><p>Если провести аналогию с <code>CSS</code>, то <code>DefaultCategory</code> это стиль наложенный на все элементы данного типа:<br><code>css<br>button {<br>color: red;<br>text-align: center;<br>}</code><br><br></p>
</aside>
<p><code>mpp-library/src/commonMain/kotlin/org/example/mpp/App.kt</code>:</p>
<pre><code>class App : BaseApplication() {
    override fun setup(): ScreenDesc&lt;Args.Empty&gt; {
        val theme = Theme()

        ...
    }
}
</code></pre>
<p>На данный момент объект создается без предедачи каких либо аргументов, но <code>Theme</code> может принимать 2 аргумента:</p>
<ul>
<li>родительская тема (все настройки родительской темы унаследуются в новую);</li>
<li>лямбда настройки темы.</li>
</ul>
<p>Сейчас используем лямбду настройки:<br><code>mpp-library/src/commonMain/kotlin/org/example/mpp/App.kt</code>:</p>
<pre><code>val Colors.orange get() = Color(0xff8a65FF)
val Colors.orangeLight get() = Color(0xffbb93FF)
val Colors.orangeDark get() = Color(0xc75b39FF)

class App : BaseApplication() {
    override fun setup(): ScreenDesc&lt;Args.Empty&gt; {
        val theme = Theme() {
            factory[ButtonWidget.DefaultCategory] = SystemButtonViewFactory(
                background = StateBackground(
                    normal = Background(
                        fill = Fill.Solid(color = Colors.orangeLight)
                    ),
                    pressed = Background(
                        fill = Fill.Solid(color = Colors.orange)
                    ),
                    disabled = Background(
                        fill = Fill.Solid(color = Colors.orangeDark)
                    )
                ),
                textStyle = TextStyle(color = Colors.black, size = 15)
            )
        }

        ...
    }
}
</code></pre>
<ul>
<li>Помимо настройки фабрики кнопок мы добавили в стандартный набор цветов свои, путем объявления экстеншен свойств;</li>
<li>У кнопки фон составной - под 3 состояния кнопки (нормальное, нажатое, выключенное), поэтому под каждое состояние мы передаем настройки фона (используем заливку определенным цветом);</li>
<li>Для указания стиля текста используем <code>TextStyle</code>;</li>
<li>У всех контейнеров стилизации (<code>TextStyle</code>, <code>Background</code> и прочие) все аттрибуты не обязательные и по умолчанию имеют значения <code>null</code>. При этом значении каждая платформа будет использовать настройку по умолчанию от самой платформы.</li>
</ul>
<p>В итоге получаем следующий результат:</p>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p class="image-container"><img alt="android-app" src="img/44525d67c8a8dca4.png"></p>
</td><td colspan="1" rowspan="1"><p class="image-container"><img alt="ios-app" src="img/70fb3ec2db41b74.png"></p>
</td></tr>
</table>


      </google-codelab-step>
    
      <google-codelab-step label="Применение стилей к группе элементов" duration="10">
        <p>Оформление группами реализуется через указание элементам отдельной <code>Category</code> и применение для этой <code>Category</code> своей фабрики в <code>Theme</code>.</p>
<aside class="special"><p>Если провести аналогию с <code>CSS</code>, то <code>Category</code> это стиль наложенный на class:<br><code>css<br>.myclass {<br>color: red;<br>text-align: center;<br>}</code><br><br></p>
</aside>
<p>Объявим в <code>App.kt</code> новую категорию кнопок. Назовем ее <code>SubmitButtonsCategory</code>:</p>
<pre><code>object SubmitButtonsCategory: ButtonWidget.Category
</code></pre>
<aside class="special"><p>За счет специального типизации через вложенный интерфейс <code>ButtonWidget.Category</code> мы можем использовать данную категорию только с кнопками и применять фабрики только кнопок.<br></p>
</aside>
<p>Далее на экранах входа используем данную категорию. Чтобы не создавать прямую зависимость из пакета <code>auth</code> в <code>App</code> сделаем в <code>AuthFactory</code> специальное свойство:<br><code>mpp-library/src/commonMain/kotlin/org/example/mpp/auth/AuthFactory.kt</code>:</p>
<pre><code>class AuthFactory(
    ...
    private val submitButtons: ButtonWidget.Category
) {
    fun createInputPhoneScreen(routeInputCode: Route&lt;String&gt;): InputPhoneScreen {
        return InputPhoneScreen(
            ...
            submitButtons = submitButtons
        )
    }

    fun createInputCodeScreen(routeMain: Route&lt;Unit&gt;): InputCodeScreen {
        return InputCodeScreen(
            ...
            submitButtons = submitButtons
        )
    }
}
</code></pre>
<p>и в классах экранов <code>InputPhoneScreen</code>, <code>InputCodeScreen</code> добавим в конструктор данный аргумент, который применим к кнопке:<br><code>mpp-library/src/commonMain/kotlin/org/example/mpp/auth/InputCodeScreen.kt</code>:</p>
<pre><code>class InputCodeScreen(
    ...
    private val submitButtons: ButtonWidget.Category
) : ... {
    ...
    
    override fun createContentWidget() = with(theme) {
        ...

        constraint(size = WidgetSize.AsParent) {
            ...

            val submitButton = +button(
                ...
                category = submitButtons
            )

            ...
        }
    }
}
</code></pre>
<p>Аналогично в <code>InputPhoneScreen</code>.</p>
<p>Остается назначить данной категории другую фабрику:<br><code>mpp-library/src/commonMain/kotlin/org/example/mpp/App.kt</code>:</p>
<pre><code>class App : BaseApplication() {
    override fun setup(): ScreenDesc&lt;Args.Empty&gt; {
        val theme = Theme() {
            ...

            factory[SubmitButtonsCategory] = SystemButtonViewFactory(
                background = StateBackground(
                    normal = Background(
                        fill = Fill.Solid(color = Colors.black)
                    ),
                    pressed = Background(
                        fill = Fill.Solid(color = Colors.black.copy(alpha = 0xAA))
                    ),
                    disabled = Background(
                        fill = Fill.Solid(color = Colors.black.copy(alpha = 0xEE))
                    )
                ),
                textStyle = TextStyle(color = Colors.white, size = 15)
            )
        }

        val authFactory = AuthFactory(theme, submitButtons = SubmitButtonsCategory)
        ...
    }
}
</code></pre>
<p>И в результате получаем кастомизированные кнопки только на двух экранах, остальные экраны используют вариант по умолчанию:</p>
<h2 is-upgraded>Android</h2>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p class="image-container"><img alt="android-app" src="img/f46fbe6ec8283b68.png"></p>
</td><td colspan="1" rowspan="1"><p class="image-container"><img alt="android-app" src="img/e75267a59981176c.png"></p>
</td></tr>
</table>
<h2 is-upgraded>iOS</h2>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p class="image-container"><img alt="ios-app" src="img/d3e954d8020d50b9.png"></p>
</td><td colspan="1" rowspan="1"><p class="image-container"><img alt="ios-app" src="img/1da206d89d03680f.png"></p>
</td></tr>
</table>


      </google-codelab-step>
    
      <google-codelab-step label="Применение стилей к отдельному элементу" duration="5">
        <p>Оформление группами реализуется через указание элементам определенного <code>Id</code> и применение для этого <code>Id</code> своей фабрики в <code>Theme</code>.</p>
<aside class="special"><p>Если провести аналогию с <code>CSS</code>, то <code>Id</code> это стиль наложенный на id:<br>&#34;`css</p>
<p>myclass {</p>
<p>color: red;<br>text-align: center;<br>}<br>&#34;`</p>
</aside>
<p>Например сделаем чтобы лейбл поля ввода телефона был оранжевым. Так как все интерактивные элементы требуют указание Id (для сохранения состояния на Android), то у нас уже есть назначенный этому полю идентификатор и мы можем это использовать:<br><code>mpp-library/src/commonMain/kotlin/org/example/mpp/App.kt</code>:</p>
<pre><code>factory[InputPhoneScreen.Ids.Phone] = SystemInputViewFactory(
    labelTextStyle = TextStyle(color = Colors.orangeDark)
)
</code></pre>
<p>И получим результат:</p>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p class="image-container"><img alt="android-app" src="img/983ccb8aa964d31c.png"></p>
</td><td colspan="1" rowspan="1"><p class="image-container"><img alt="ios-app" src="img/755599b738bfc403.png"></p>
</td></tr>
</table>


      </google-codelab-step>
    
      <google-codelab-step label="Наследование тем" duration="10">
        <p><code>Theme</code> может быть унаследована от другой, взяв всю кастомизацию родителя и дополнив своей.<br>Например мы хотим сделать чтобы кнопки на экране профиля все были визуально другие, мы можем сделать это через отдельную категорию и прокидывать ее через конструкторы, либо же сделать другую тему, которую дадим в экран профиля.</p>
<pre><code>val profileTheme = Theme(parent = theme) {
    factory[ButtonWidget.DefaultCategory] = SystemButtonViewFactory(
        background = StateBackground(
            normal = Background(
                fill = Fill.Solid(color = Colors.orangeLight)
            ),
            pressed = Background(
                fill = Fill.Solid(color = Colors.orange)
            ),
            disabled = Background(
                fill = Fill.Solid(color = Colors.orangeDark)
            )
        ),
        textStyle = TextStyle(color = Colors.black, size = 24)
    )
}

...
val profileFactory = ProfileFactory(profileTheme)
</code></pre>
<p>Мы создали на основе темы <code>theme</code> новую тему, заменив в ней фабрику по умолчанию для кнопок. Теперь на экранах профиля (они создаются фабрикой <code>ProfileFactory</code>) будут кнопки с большим текстом.</p>
<h2 is-upgraded>Android</h2>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p class="image-container"><img alt="android-app" src="img/38b95273249ff4cd.png"></p>
</td><td colspan="1" rowspan="1"><p class="image-container"><img alt="android-app" src="img/c0154a3a1ee4d0ba.png"></p>
</td></tr>
</table>
<h2 is-upgraded>iOS</h2>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p class="image-container"><img alt="ios-app" src="img/2aac207f12e66f0c.png"></p>
</td><td colspan="1" rowspan="1"><p class="image-container"><img alt="ios-app" src="img/331ccbaab14c4ad3.png"></p>
</td></tr>
</table>


      </google-codelab-step>
    
      <google-codelab-step label="Применение стилей к нижней навигации" duration="10">
        <pre><code>class MainBottomNavigationScreen(
    router: Router,
    builder: BottomNavigationItem.Builder.() -&gt; Unit
) : BottomNavigationScreen(router, builder), NavigationItem {
    override val navigationBar: NavigationBar = NavigationBar.None
    
    init {
        bottomNavigationColor = Colors.orangeDark
    }
}
</code></pre>
<p>И получим результат:</p>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p class="image-container"><img alt="android-app" src="img/dd000dec6407185b.png"></p>
</td><td colspan="1" rowspan="1"><p class="image-container"><img alt="ios-app" src="img/6563815cf9e0007b.png"></p>
</td></tr>
</table>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>

</body>
</html>
